(()=>{"use strict";const e=e=>{let t=0;return new Promise(((n,a)=>{const d=setInterval((()=>{t+=1;const o=document.querySelector(e);o&&(clearInterval(d),n(o)),t>=25&&a(`Could not load the ${e}`)}),200)}))},t=e=>e?e.toLowerCase():"",n=()=>{const e=[...document.getElementsByName("radio-check")].find((e=>e.checked)).Id,n=window.parsedData.find((t=>t.id===e));console.log(n);const a={name_text:document.getElementById("ctl00_HomePageContent_ctrlTextEmpName"),father_radio:document.getElementById("ctl00_HomePageContent_ctrlFatherOrHus_0"),husband_radio:document.getElementById("ctl00_HomePageContent_ctrlFatherOrHus_1"),fatherOrHusband_text:document.getElementById("ctl00_HomePageContent_ctrlTextFatherHusName"),dateOfBirth_text:document.getElementById("ctl00_HomePageContent_ctrlTxtIpDate"),maritalStatus_option:document.getElementById("ctl00_HomePageContent_ctrlRDMarried"),genderMale_radio:document.getElementById("ctl00_HomePageContent_ctrlRDMale_0"),genderFemale_radio:document.getElementById("ctl00_HomePageContent_ctrlRDMale_1"),genderTrans_radio:document.getElementById("ctl00_HomePageContent_ctrlRDMale_2")},d={maritalStatus:{unmarried:1,married:2,widow:3,widower:4},relation:{father:a.father_radio,husband:a.husband_radio},gender:{male:a.genderMale_radio,female:a.genderFemale_radio,transgender:a.genderTrans_radio}},o=d.relation[t(n.RELATION)],l=d.maritalStatus[t(n["MARITAL STATUS"])],r=d.gender[t(n["GENDER M/F"])];a.name_text.value=n["FULL NAME"],a.dateOfBirth_text.value="01/01/2026",o.checked=!0,a.fatherOrHusband_text.value=n["FATHER/HUSBAND NAME"],a.maritalStatus_option.value=l,r.checked=!0},a=e=>`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`,d=e=>{const t=document.getElementById("message");t.textContent=e,t.classList.add("show","error")},o=()=>{const e=document.getElementById("message");e.classList.remove("show"),e.textContent=""},l=()=>{document.querySelector("#dataTable tbody").innerHTML=null,document.querySelector(".data-table-container").style.display="none"},r=()=>{document.getElementById("modal").classList.remove("active")},c=()=>{document.getElementById("modal").classList.add("active"),document.getElementById("fileInput").value="",o(),l()},s={isReady:!1,error:null,load:()=>{if(!0===s.isReady)return void console.log("Script already loaded");const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js",e.onload=()=>{console.log("SheetJS library loaded."),s.isReady=!0},e.onerror=()=>{s.error="Failed to load Excel library."},document.head.appendChild(e)}},i=async()=>{const e=document.createElement("div");e.innerHTML='\n\t<div id="modal" class="modal-overlay">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title">ESIC Form Helper</h2>\n            </div>\n\n            <div class="modal-body">\n                <div class="input-group">\n                    <input type="file" id="fileInput" class="file-input">\n                </div>\n\n\t\t\t\t<div id="message" class="message">\n                    Please select a file to upload.\n                </div>\n\n                <div class="data-table-container">\n                    <table class="data-table" id="dataTable">\n                        <thead>\n                            <tr>\n                                <th>Select</th>\n                                <th>Name</th>\n                                <th>DOB</th>\n                                <th>Site</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <div class="modal-footer">\n                <button id="cancelBtn" class="cancel-btn">\n                    Cancel\n                </button>\n                <button id="proceedBtn" class="proceed-btn" disabled>\n                    Proceed\n                </button>\n            </div>\n        </div>\n    </div>\n',document.body.append(e);const t=document.getElementById("modal");t.addEventListener("click",(e=>{e.target===t&&r()})),document.getElementById("cancelBtn").addEventListener("click",r),s.load(),document.getElementById("proceedBtn").addEventListener("click",n),fileInput.addEventListener("change",(({target:e})=>{o(),l();const t=e.files[0];if(!t)return void d("Please select an excel file.");if(!s.isReady)return void d(s.error??"Excel library not loaded!");const n=(e=>{const t=e.name.toLowerCase(),n=[".xlsx",".xls"].some((e=>t.endsWith(e))),a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(e.type),d=n||a;return d&&console.log("Valid excel file recieved..."),d})(t);n?(e=>{const t=new FileReader;t.onload=function(e){const t=new Uint8Array(e.target.result),n=XLSX.read(t,{type:"array"}),o=n.SheetNames.find((e=>e.toLowerCase().includes("esic")));if(!o)return void d("ESIC sheet not found!");const r=n.Sheets[o],c=XLSX.utils.sheet_to_json(r,{header:1,defval:null}),s=[],i=c[0];c.slice(1).forEach((e=>{const t={Id:crypto.randomUUID()};e.forEach(((e,n)=>{if(i[n]){const a=i[n].trim().replace(/^\.+|\.+$/g,"").toUpperCase();t[a]=e}})),s.push(t)}));const m=s.filter((e=>{const t=e["ESIC NO"];if(t&&"string"==typeof t)return"new"===t?.toLowerCase()}));window.parsedData=m;(e=>{const t=e=>{const t=document.createElement("td");return t.textContent=e,t},n=({target:e})=>{const t=[...document.getElementsByName("radio-check")];e.checked&&t.forEach((t=>{t!==e&&(t.checked=!1)})),document.getElementById("proceedBtn").disabled=!t.some((e=>e.checked))};l();const a=document.querySelector("#dataTable tbody");0!==e.length?(e.forEach((e=>{const d=document.createElement("tr"),o=document.createElement("td"),l=document.createElement("input");l.type="checkbox",l.name="radio-check",l.value=e.Id,l.addEventListener("change",n),o.appendChild(l),d.appendChild(o),d.appendChild(t(e.Name)),d.appendChild(t(e.DOB)),d.appendChild(t(e.Site)),a.append(d)})),document.querySelector(".data-table-container").style.display="block"):d("New ESIC not available!")})(m.map((e=>{return{Id:e.Id,Name:e["FULL NAME"],DOB:a((t=e.DOB,t&&"number"==typeof t?new Date(86400*(t-25569)*1e3):t)),Site:e["SITE NAME"]};var t})))},t.onerror=function(){d("error while reading file!")},t.readAsArrayBuffer(e)})(t):d("Invalid excel file selected!")}))};console.log("Injecting ESIC Script..."),(async()=>{const t=window.location.href.split("/");t.some((e=>e.includes("EmployeeCounterFoilRegistration")))?e("#ctl00_lbluserName").then((e=>{i(),e.style="color: darkgreen; font-weight: bold; cursor: pointer;",e.addEventListener("click",c)})):t.some((e=>e.includes("PortalHome")))&&e("#div1_close").then((e=>{e.onclick=null,e.click()}))})()})();